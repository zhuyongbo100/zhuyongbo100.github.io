(self["webpackChunkproject_v2"]=self["webpackChunkproject_v2"]||[]).push([[5442],{56629:function(e,t,a){var s=a(39854);s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.id,s,""]]),s.locals&&(e.exports=s.locals);var n=a(56).Z;n("76729304",s,!0,{sourceMap:!1,shadowMode:!1})},52147:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return v}});var s,n={uIcon:a(28317).Z,zbTable:a(87012).Z,uPicker:a(59633).Z},c=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-uni-view",{staticClass:"tableScore-page"},[a("v-uni-view",{staticClass:"content"},[1==e.mode?[a("v-uni-view",{staticClass:"title"},[a("h3",[e._v(e._s(e.examName))])])]:2==e.mode?[a("v-uni-view",{staticClass:"class_f"},[a("v-uni-view",{staticClass:"select-item",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.classModal=!0}}},[a("v-uni-text",[e._v(e._s(e.className))]),a("v-uni-view",{staticClass:"icon"},[a("u-icon",{attrs:{name:"arrow-down",size:"14",color:"#303133"}})],1)],1)],1),a("v-uni-view",{staticClass:"title",staticStyle:{height:"100rpx"}},[a("h3",[e._v(e._s(e.examName)+"（"+e._s(e.className)+"）")])])]:e._e(),a("v-uni-view",{staticClass:"table",style:e.tableHeight},[a("zb-table",{ref:"zbTable",attrs:{"show-header":!0,columns:e.columns,stripe:!0,fit:!1,border:!0,data:e.data,isShowLoadMore:!1,tableQuery:e.tableQuery},on:{"sort-change":function(t){arguments[0]=t=e.$handleEvent(t),e.sortChange.apply(void 0,arguments)}}})],1)],2),a("u-picker",{attrs:{show:e.classModal,columns:e.classColumns,keyName:"label"},on:{cancel:function(t){arguments[0]=t=e.$handleEvent(t),e.classModal=!1},confirm:function(t){arguments[0]=t=e.$handleEvent(t),e.confirmClass.apply(void 0,arguments)}}})],1)},r=[],o=a(66407),l=a(4587),i=a(41541),u=(a(38077),a(60228),a(76801),a(43843),a(50886),a(34338),a(47522),a(70560),a(80843)),d=a(87012),h=a(81980)["Z"],m={name:"tableScore",components:{ZbTable:d.Z},data:function(){return{examId:"",examName:"",mode:1,classId:"",schoolId:"",classIds:"",className:"请选择班级",classModal:!1,classColumns:[],tableColumns:[],loading:!1,total:150,tableList:[],columns:[],data:[],tableQuery:{}}},computed:(0,i.Z)((0,i.Z)({},(0,u.mapState)(["userInfo","appType","currentYear"])),{},{tableHeight:function(){return 2==this.mode?"height: calc(100vh - 160rpx)":"height: calc(100vh - 100rpx)"}}),onLoad:function(e){var t=this;return(0,l.Z)((0,o.Z)().mark((function a(){return(0,o.Z)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!e||!e.examId){a.next=11;break}if(t.examId=e.examId,t.examName=e.examName,e.classId&&(t.mode=1,t.classId=e.classId),!e.classIds){a.next=10;break}return t.mode=2,t.schoolId=e.schoolId,t.classIds=e.classIds,a.next=10,t.getClass();case 10:t.query();case 11:case"end":return a.stop()}}),a)})))()},methods:{getClass:function(){var e=this;return this.$api.base.getClass({xxJbxxId:this.schoolId}).then((function(t){var a=t||[],s=e.classIds.split(","),n=a.filter((function(e){return s.includes(e.xxBjxxId)}));n=n.map((function(e){return e.label=e.xxBjxxZh+"（".concat(e.xxNjxxZh,"）"),e.value=e.xxBjxxId,e})),n&&n.length>0&&(e.classId=n[0].value,e.className=n[0].xxBjxxZh,e.classColumns=[n])}))},sortChange:function(e,t,a){var s=this;return(0,l.Z)((0,o.Z)().mark((function n(){var c,r,l,u,d,m,b,f;return(0,o.Z)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:h.log("触发排序",e,t,a),c="",r="",l=t,e.name&&e.name.includes("_")?(u=e.name.split("_")[0],d=e.name.split("_")[1],"score"==u?c="subject":"subjectGradeRank"==u?c="subject_grade_rank":"subjectClassRank"==u&&(c="subject_class_rank"),r="".concat(d,"-").concat(l)):(c="other",r="".concat(e.name,"-").concat(l)),m={orderName:c,orderBy:r},s.classId&&(b=[s.classId]),s.tableQuery=(0,i.Z)((0,i.Z)({},e),{},{sorterMode:t}),f=(0,i.Z)({schoolYearId:s.currentYear.schoolYearId,termId:s.currentYear.termId,classIds:b},m),s.$api.score.getStudentsScore(s.examId,f).then((function(e){var t=e.list||[];s.data=t.map((function(e){var t=e.subjectScoreList||[];return t.forEach((function(t){2==e.sendType?e["score_".concat(t.subjectId)]=t.level:3==e.sendType?e["score_".concat(t.subjectId)]="".concat(t.score,"/").concat(t.level):e["score_".concat(t.subjectId)]="".concat(t.score),e["subjectGradeRank_".concat(t.subjectId)]=t.subjectGradeRank,e["subjectClassRank_".concat(t.subjectId)]=t.subjectClassRank})),e}))}));case 10:case"end":return n.stop()}}),n)})))()},getTableColumns:function(){var e=this;return(0,l.Z)((0,o.Z)().mark((function t(){return(0,o.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",e.$api.score.getStudentTable(e.examId).then((function(t){if(t){var a=t.titleList||[],s=[{name:"studentName",label:"学生姓名",emptyString:"-",align:"center"},{name:"totalScore",label:"总分",sorter:"custom",emptyString:"-",align:"center"}],n=[];a.forEach((function(e){e.id?n.push({name:"".concat(e.key,"_").concat(e.id),label:e.name,sorter:"custom",emptyString:"-",align:"center"}):n.push({name:e.key,label:e.name,sorter:"custom",emptyString:"-",align:"center"})})),e.columns=s.concat(n)}})));case 1:case"end":return t.stop()}}),t)})))()},getTableData:function(){var e=this;return(0,l.Z)((0,o.Z)().mark((function t(){var a;return(0,o.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.classId&&(a=[e.classId]),e.tableQuery={label:"总分",name:"totalScore",sorterMode:"desc"},t.abrupt("return",e.$api.score.getStudentsScore(e.examId,{schoolYearId:e.currentYear.schoolYearId,termId:e.currentYear.termId,orderName:"other",orderBy:"totalScore-desc",classIds:a}).then((function(t){var a=t.list||[];e.data=a.map((function(e){var t=e.subjectScoreList||[];return t.forEach((function(t){2==e.sendType?e["score_".concat(t.subjectId)]=t.level:3==e.sendType?e["score_".concat(t.subjectId)]="".concat(t.score,"/").concat(t.level):e["score_".concat(t.subjectId)]="".concat(t.score),e["subjectGradeRank_".concat(t.subjectId)]=t.subjectGradeRank,e["subjectClassRank_".concat(t.subjectId)]=t.subjectClassRank})),e}))})));case 3:case"end":return t.stop()}}),t)})))()},query:function(){var e=this;return(0,l.Z)((0,o.Z)().mark((function t(){return(0,o.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getTableColumns();case 2:return t.next=4,e.getTableData();case 4:case"end":return t.stop()}}),t)})))()},confirmClass:function(e){e&&e.value&&e.value.length>0&&(this.className=e.value[0].xxBjxxZh,this.classId=e.value[0].value,this.classModal=!1,this.query())}}},b=m,f=(a(56629),a(69453)),p=(0,f.Z)(b,c,r,!1,null,"b751c7d4",null,!1,n,s),v=p.exports},39854:function(e,t,a){"use strict";a.r(t);var s=a(8081),n=a.n(s),c=a(23645),r=a.n(c),o=r()(n());o.push([e.id,'@charset "UTF-8";\n/* uview 颜色变量 */.tableScore-page[data-v-b751c7d4]{position:fixed;width:100%;height:100%;padding:0;margin:0;overflow:hidden;background:#fff}.tableScore-page .content .class_f[data-v-b751c7d4]{height:%?60?%;display:flex;justify-content:center;align-items:center}.tableScore-page .content .class_f .select-item[data-v-b751c7d4]{display:flex;font-size:%?28?%;align-items:center;justify-content:flex-start;padding:%?8?% %?20?%}.tableScore-page .content .class_f .icon[data-v-b751c7d4]{padding-left:%?20?%}.tableScore-page .content .title[data-v-b751c7d4]{height:%?100?%;text-align:center;line-height:%?100?%}',""]),t["default"]=o}}]);